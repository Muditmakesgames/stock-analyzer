
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personalized Stock Portfolio Analyzer</title>
  <style>
    body { font-family: Arial, sans-serif; background: #1e293b; color: white; margin: 0; padding: 20px; }
    .container { max-width: 800px; margin: auto; }
    .section { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
    label { display: block; margin-bottom: 6px; font-weight: bold; }
    input, select, textarea, button { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #3b82f6; background: #1e293b; color: white; }
    button { background: #3b82f6; cursor: pointer; }
    img { max-width: 100%; margin-top: 10px; border-radius: 8px; }
    pre { background: #111827; padding: 15px; border-radius: 8px; overflow-x: auto; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Personalized Stock Portfolio Analyzer</h1>

    <!-- Upload Section -->
    <div class="section" id="upload-section">
      <h2>Upload Your Portfolio Screenshot</h2>
      <input type="file" id="image-input" accept="image/*">
      <img id="preview" src="" alt="" style="display:none;">
    </div>

    <!-- Profile Questions -->
    <div class="section" id="profile-section">
      <h2>Your Investment Profile</h2>
      <label for="timeHorizon">Time Horizon</label>
      <select id="timeHorizon">
        <option value="">Select timeline...</option>
        <option value="Less than 1 year">Less than 1 year (short-term)</option>
        <option value="1-3 years">1-3 years (medium-term)</option>
        <option value="3-10 years">3-10 years (long-term)</option>
        <option value="10+ years">10+ years (retirement/legacy)</option>
      </select>

      <label for="riskTolerance">Risk Tolerance</label>
      <select id="riskTolerance">
        <option value="">Select risk comfort...</option>
        <option value="Conservative">Conservative - I lose sleep over 10% drops</option>
        <option value="Moderate">Moderate - I can handle some ups and downs</option>
        <option value="Aggressive">Aggressive - I'm comfortable with significant volatility</option>
        <option value="Very Aggressive">Very Aggressive - Volatility doesn't bother me</option>
      </select>

      <label for="goals">Investment Goals</label>
      <textarea id="goals" placeholder="E.g., retirement, saving for a house..."></textarea>

      <label for="concerns">Specific Concerns (Optional)</label>
      <textarea id="concerns" placeholder="E.g., worried about tech concentration..."></textarea>

      <button id="analyzeBtn">Analyze Portfolio</button>
    </div>

    <!-- Analysis Results -->
    <div class="section" id="results-section" style="display:none;">
      <h2>Analysis Results</h2>
      <pre id="analysis"></pre>
    </div>
  </div>

  <script>
    const imageInput = document.getElementById("image-input");
    const preview = document.getElementById("preview");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const analysisContainer = document.getElementById("results-section");
    const analysisText = document.getElementById("analysis");

    let selectedFile = null;

    imageInput.addEventListener("change", e => {
      selectedFile = e.target.files[0];
      if(selectedFile) {
        const reader = new FileReader();
        reader.onload = () => {
          preview.src = reader.result;
          preview.style.display = "block";
        }
        reader.readAsDataURL(selectedFile);
      }
    });

    analyzeBtn.addEventListener("click", async () => {
      const timeHorizon = document.getElementById("timeHorizon").value;
      const riskTolerance = document.getElementById("riskTolerance").value;
      const goals = document.getElementById("goals").value;
      const concerns = document.getElementById("concerns").value;

      if(!selectedFile || !timeHorizon || !riskTolerance || !goals){
        alert("Please upload an image and fill out all required fields.");
        return;
      }

      const formData = new FormData();
      formData.append("image", selectedFile);
      formData.append("timeHorizon", timeHorizon);
      formData.append("riskTolerance", riskTolerance);
      formData.append("goals", goals);
      formData.append("concerns", concerns);

      analysisText.textContent = "Analyzing... please wait.";
      analysisContainer.style.display = "block";

      try {
        const response = await fetch("/api/analyze", {
          method: "POST",
          body: formData
        });
        const data = await response.json();
        analysisText.textContent = data.analysis || "No response from AI.";
      } catch (err) {
        analysisText.textContent = "Error analyzing portfolio.";
        console.error(err);
      }
    });
  </script>
</body>
</html>
